%%%%%%%%%%%%%%%%%%%%%%%%
%                                                                       %
% Verification and Validation   %
%                                                                        %
%%%%%%%%%%%%%%%%%%%%%%%%%

\chapter{Verification and Validation}
\label{chapter:validation}
%COMMENTED OUT AFTER TONY's REVIEW
%TONY: In this section, all you are doing is testing if your program generates a similar results as given by another program. There is no need to talk about the geological model or problem. Talking about diagenesis and any implication to petroleum system is out of question.

%During the development of this work, we have always been in contact with geochemists to present them the partial results of our geochemical speciation modelling software. We collected feedbacks regarding how to achieve a better software, as well as checking if our solution is fulfilling its purpose with consistent results. \\
%As final evaluation of this work, we selected an application relevant to petroleum systems. Many physical-chemical reactions happens during the generation, migration and storage of oil. \emph{Diagenesis} is the definition of the several processes that are involved and it is driven by multiple factors as temperature, pressure, mineral composition, water composition, activity of the solutes, pH, etc. 
%The \emph{diagenesis} is responsible for compaction and precipitation of minerals \cite{Tucker:01} and therefore, porosity, solubility and permeability of these reservoirs. The study of diagenesis is important because it allows to understand the geologic history of rocks, specially sedimentary rocks. In sedimentary rocks, the deposition of sediments are compacted in different layers and cemented by minerals that precipitate from reactions in a chemically very active environment. The \emph{diagenesis} reactions happens because the components are always trying to reach equilibrium, and therefore, they tend to interact with each others \cite{Burley:85}.
%Using geochemical modelling softwares is a powerful tool to understand the diagenetic processes and the natural conditions that occur in this natural environment. The goal is to numerically model this environment and analyse the results of the diagenetic reactions with a petrographic analysis of the modeled reservoirs.

\section{Case Study}
For the modelâ€™s validation, the diagenetic reactions observed in Snorre Field reservoir sandstones, Norwegian North Sea was simulated. The modeling set up and results given in Morad \cite{Morad:90} describes the texture, origin, chemistry of the sandstones reservoirs in terms of the water composition and temperature. Against this \emph{SHPECK}'s results were examined.

The descriptions presented in \cite{Morad:90} of the diagenetic reactions that take place in the Snorre Field allows us to generate a computationally comparative study. We model and compare the same environment using \emph{SHPECK}, \emph{PHREEQC} and \emph{MINTEQA2}. The water composition is detailed in \cite{Nordstrom:79}.


\subsection{Experimentally validation of Shpeck}
As stated in \cite{Morad:90}, the model presented in \cite{Egeberg:88} calculates activities of the various ions of formations waters using ion association model (originally described in \cite{Wigley:77}). 
The thermodynamics data used are given in \cite{Helgeson:74a},  \cite{Helgeson:74b}, \cite{Helgeson:76}, \cite{Waltter:77}, \cite{Helgeson:78} and \cite{Helgeson:81}.

The activity diagram generated for a known of temperature and for log activity ratio of Potassium to Sodium ions of \cite{Aagaard:90} is used to examine the result from the SHPECK model (Figure ~\ref{fig:tempXactratio}). The results are consistent, shows consistent pattern: As the temperature rises the potassium activity gets higher over sodium's. Which means that the minerals associated to the ion potassium (i.e. K-feldspar, Illite, etc) are dissolving.


\begin{figure}[ht!]
\centering
\includegraphics[width=100mm]{figures/tempXactratio.png}
\caption{Log activity ratio of Potassium to Sodium ions using the results from \emph{SHPECK}}
\label{fig:tempXactratio}
\end{figure}

% QUESTION:
% LEO: I wasn't sure if I should put the figure from aagaard's in order to really prove that our results are consistent.... I don't like the idea of putting someone else's graph in here..
%TONY: You cannot use a published figure without getting the copyright waive from the publisher. What you can do is to replicate the figure of Aagaard using your own resources.


\subsection{Computationally comparative study} 
By modeling the same environment using three different software, we achieve a relevant comparison among the numerical methods and algorithms. 

Chemical composition of the water used in the models is taken from \cite{Nordstrom:79} which provides the chemical composition of the sea water (table ~\ref{tab:nordstrom}. The temperature on this comparative study tested conditions from $25^o$C to $160^o$C. In MINTEQA2, due to limitations of its thermodynamics equilibrium database, the maximum temperature available is $100^o$C.

\begin{table}
\caption{Chemical composition of the solution in the sea water at $25^o$ in $mM/L$C }
\label{tab:nordstrom}
\centering
\begin{tabular}{r|c|c|c|c|c|c|c|c|c}
\ce{Al^{3+}} & \ce{K^+} & \ce{Na^+} & \ce{Ca^{2+}} & \ce{Mg^{2+}} & \ce{Fe^{2+}} & \ce{SiO_2}&  
\ce{SO_4^{2-}} & \ce{Cl^-} & pH
    \\ \hline
7.59e-5 & 10.45 & 479.32 & 10.53 & 54.39 & 3.66e-5 & 0.073 & 28.893 & 559.5 & 8.22
\end{tabular}
\end{table}

The diagenetic processes modelled by the water-rock interactions are responsible for defining how of ions present the solution are going to behave. Figures ~\ref{fig:na+},~\ref{fig:cl-},~\ref{fig:mg+2},~\ref{fig:ca+2},~\ref{fig:k+} and ~\ref{fig:so4-2} present the most representative ions in the solution. It is possible to see that the behavior of \emph{SHPECK} accompany both \emph{PHREEQC} and \emph{MINTEQA2} in most of the cases, specially in temperatures under $100^o$C. We see a more distant behavior among \emph{SHPECK} and \emph{PHREEQC} in temperatures higher than $100^o$C but never completely opposites. This is explained due to temperatures where the equilibrium constant \emph{K} is not completely defined. This is a known issue from \emph{LLNL} thermodynamic dataset: sometimes equilibrium constants are not measured and unknown. \emph{SHPECK} adopts the nearest equilibrium constant known value. Unfortunately we do not have access to each software's details in order to describe how they treat this issue.

\begin{figure}[ht!]
\centering
\includegraphics[width=140mm]{figures/na+.png}
\caption{\ce{Na^+} log activity comparative study}
\label{fig:na+}
\end{figure}

\begin{figure}[ht!]
\centering
\includegraphics[width=140mm]{figures/cl-.png}
\caption{\ce{Cl^-} log activity comparative study}
\label{fig:cl-}
\end{figure}

\begin{figure}[ht!]
\centering
\includegraphics[width=140mm]{figures/mg+2.png}
\caption{\ce{Mg^{+2}} log activity comparative study}
\label{fig:mg+2}
\end{figure}

\begin{figure}[ht!]
\centering
\includegraphics[width=140mm]{figures/ca+2.png}
\caption{\ce{Ca^{+2}} log activity comparative study}
\label{fig:ca+2}
\end{figure}

\begin{figure}[ht!]
\centering
\includegraphics[width=140mm]{figures/k+.png}
\caption{\ce{K^+} log activity comparative study}
\label{fig:k+}
\end{figure}

\begin{figure}[ht!]
\centering
\includegraphics[width=140mm]{figures/so4-2.png}
\caption{\ce{SO_4^{-2}} log activity comparative study}
\label{fig:so4-2}
\end{figure}


\section{Database Evaluation}
All geochemical models used for comparison studies use text files as the database. The goal of this section is to make clear the difference and - more importantly - the benefits of \emph{SHPECK}'s relational database. Most of the information inside a geochemical database is related to each other (i.e. a mineral is described by a reaction, a reaction is composed by solute species, and a solute species is composed of chemical elements). \emph{SQLite} databases are naturally a structure where the data can be related to each other, and this significantly improvements the performance and robustness of the application. On \emph{SQLite} databases, the data can be accessed using \emph{SQL} queries that reduce the complexity and increase the speed on information retrieval - code~\ref{cod:sqlQuery} shows a complex \emph{SHPECK}'s \emph{SQLite} query. Text database files only allow continuous access to the information that it contains. In relation databases the \emph{SQL} language is used to selectively locate needed data. 


\begin{minipage}{\linewidth}
\begin{lstlisting}[frame=single, label=cod:sqlQuery, caption=\emph{SHPECK}'s \emph{SQLite} example query]
SELECT compoundsComposition.element, compoundsComposition.name, compoundsComposition.stoich, compounds.eqConstant, termoPolynom.zero, termoPolynom.one, termoPolynom.two, termoPolynom.three, termoPolynom.four, termoPolynom.five, termoPolynom.six, termoPolynom.seven FROM termoPolynom, compoundsComposition, compounds WHERE compoundsComposition.name = compounds.name AND termoPolynom.name = compounds.name AND compounds.name = XXXXX;
\end{lstlisting}
\end{minipage}

Important to note that at each simulation the value "XXXX" in code~\ref{cod:sqlQuery} is updated to the simulation's solute name, also interesting to point that the information fetched with this query comes from three different tables and at only one query many relevant information for the simulation is fetched.

\subsection{Time analysis}
The response time is considered the sum of the processing time and the time waiting for the availability of the resource. It is necessary to understand that until the software has received all the information requested from the database it is inactive and in a standby mode. In order to analyze the response time with a geochemical analysis point of view, we discuss not only the access time but also the implications of that information.

When fetching any information from a thermodynamic dataset, it is important to take into consideration additional allied data will also have to be retrieved. For example, when fetching a reaction (as expressed in equation~\ref{reaction}) data, the basic information consists of the compounds that take part on this reaction and the related stoichiometric values. Behind this action, the database must also provide information about the compounds itself (i.e. charge, ion size, mole weight, elements in that specie, formula, mole volume) as well as the reaction (i.e., thermodynamic equilibrium constant coefficients, etc).

Figure ~\ref{fig:timeXaccess} indicates the time elapsed (in seconds) that it takes to retrieve all necessary information related to a chemical reaction from the database. In this example, we simulated from 20 to 580 randomly selected reactions in the database. It is possible to see that \emph{SHPECK}'s database has improved approximately 40\% in the average time elapsed to fetch the information if compared to the regulat text file database used by others.

\begin{figure}[ht!]
\centering
\includegraphics[width=140mm]{figures/timeXreactionAccess.png}
\caption{Time elapsed in seconds X Reactions Accessed}
\label{fig:timeXaccess}
\end{figure}



\newpage

\section{Summary}
\begin{itemize}
    \item Diagenesis: This term refers to chemical and physical changes taking place in a rock due to chemical reactions. In this study we reproduce the diagenetic reactions observed in Snorre Field reservoir sandstones, Norwegian North Sea. 
    The environment modeled is described in \cite{Morad:90} and the chemical composition of the water in \cite{Nordstrom:79}.
    \item Comparative study: We performed a comparative study of \emph{SHPECK} and other available geochemical speciation software. The results prove that \emph{SHPECK} produce comparable results. The discrepancies are minimal and the differences can be justified by the software-specific implementations of the mathematical and computational treatment to the set of equations and other parameters. 
    \item Database evaluation: The lack of a relational database in the geochemical modeling software makes it clear that none of the existing options were developed with emphasis on a computer science emphasis. \emph{SHPECK} uses a \emph{SQLite} database specially developed to support a geochemical speciation modeling software. This software design option enables the software to achieve efficient performance, and handle complex data queries and retrieval. A comparative graph highlights the advantages in time elapsed by the number of reactions requested.
\end{itemize}